<% title "Complete Bulk Import"%>

<h1>Step 2: Complete Bulk Import</h1>

<div class="ma">
  
  <%= form_tag create_bulk_mtg_listings_path do %>

    <%= hidden_field_tag 'sort', params[:sort] %>    
    <%= hidden_field_tag 'mtg_listing[price]', params[:mtg_listing][:price] %>            
    <%= hidden_field_tag 'mtg_listing[set]', params[:mtg_listing][:set] %>        
    <%= hidden_field_tag 'mtg_listing[language]', params[:mtg_listing][:language] %>
    <%= hidden_field_tag 'mtg_listing[condition]', params[:mtg_listing][:condition] %>
    <%= hidden_field_tag 'mtg_listing[foil]', params[:mtg_listing][:foil] %>
    
    <table class="data">
      <tr class="header_row">
        <th colspan=2>Settings for all listings</th>
      </tr>
      <tr class="odd">
        <td width="50%">Set</td>
        <td><%= display_set_symbol @set %></td>
      </tr>      
      <tr class="even">
        <td width="50%">Language</td>
        <td><%= display_flag_symbol(params[:mtg_listing][:language]) %></td>
      </tr>
      <tr class="odd">
        <td width="50%">Condition</td>
        <td><%= display_condition params[:mtg_listing][:condition] %></td>
      </tr>   
      <tr class="even">
        <td width="50%">Advanced Options</td>
        <td><%= params[:mtg_listing][:foil] == "1" ? "Foil Stamped" : "None" %></td>
      </tr>
    </table>
    
    <br class="spacer"/>
    
    <table class="data">
      <tr class="header_row">
        <th colspan=4>Individual listings</th>
      </tr>
      <tr class="header_row">
        <th>Number</th>
        <th>Card Name</th>
        <th>Asking Price</th>
        <th>Quantity</th>
      </tr>
      <% @cards.each do |card| %>
        <tr class=<%= cycle("odd", "even") %>>
          <td><%= card.card_number.to_i %></td>
          <td><%= link_to card.name, mtg_card_path(card), :target => "_blank", :alt => "click to see card details" %></td>
          <td>
            <%
              if params[:sales] && params[:sales]["#{card.id}"]
                price_selection = params[:sales]["#{card.id}"][:price]
              elsif params[:mtg_listing][:price] == "low"
                price_selection = card.statistics.price_low
              elsif params[:mtg_listing][:price] == "high"
                price_selection = card.statistics.price_high
              else                
                price_selection = card.statistics.price_med
              end                
            %>
            <%= select_tag "sales[#{card.id}][price]", options_for_select( [["Low ($#{card.statistics.price_low})",     card.statistics.price_low], 
                                                                   ["Average ($#{card.statistics.price_med})",  card.statistics.price_med], 
                                                                   ["High ($#{card.statistics.price_high})",    card.statistics.price_high],
                                                                   ["Other", "other"]], :selected => price_selection ), 
                                               :class => "chzn-select",
                                               :style => "width:150px;" %>
          </td>
          <td>
            <%= text_field_tag "sales[#{card.id}][quantity]", (params[:sales] && params[:sales]["#{card.id}"]) ? params[:sales]["#{card.id}"][:quantity] : 0, :style => "width:30px;" %>
          </td>
        </tr>
      <% end %>
    </table>
    
    <br class="spacer"/>
    <div style="width:400px;text-align:center;" class="center"><b>Note:</b> Please double check the form for accuracy before submitting. This process cannot be easily reversed!</div>  

    <br class="spacer"/>
    <br class="spacer"/>    
    <%= submit_tag "Complete Bulk Import", :class => "center", :confirm => "Are you sure you want to add sale listings for all these cards?"%>

    <br class="spacer"/>
    <br class="spacer"/>    
        
  <% end %>
  
</div>