<% title "my listings"%>
<h1>My Listings</h1>
<div id="content">

  <div class="group center_wrap">
    <ul class="tabs">
      <li <%= "class=selected" if params[:status] == nil || params[:status] == "" %>> <%= link_to "All (#{current_user.mtg_listings.count})", url_for(params.merge(:status => nil)), :remote => true %> </li>
      <li <%= "class=selected" if params[:status] == "active" %>>                     <%= link_to "Active (#{current_user.mtg_listings.active.count})", url_for(params.merge(:status => "active")), :remote => true %> </li>
      <li <%= "class=selected" if params[:status] == "inactive" %>>                   <%= link_to "Inactive (#{current_user.mtg_listings.inactive.count})", url_for(params.merge(:status => "inactive")), :remote => true %> </li>      
    </ul>
  </div>

  <%#= link_to "Create a New Listing", new_generic_mtg_cards_listings_path, :class => "right", :style => "margin-top:23px;margin-right:10px;" %>
  <div>
    <div class="text_in_h2">
      <%= render :partial => '/mtg/apply_filters', :locals =>  { :remote => true } %>  
    </div>
    <h2><%="#{@listings.total_count} #{(params[:status] || "").capitalize} Listings"%></h2>
  </div>
  
  <% if @listings.count > 0 %>
  
  	<%= form_tag mtg_cards_listings_multiple_process_request_path, :id => "multiple_listing_edit_form", :method => :post do %>
      <%= submit_tag "Delete", :id => "delete_submit_button", :style => "display:none;", :confirm => "Are you sure you want to permanently delete selected listing(s)?"%>
      <%= hidden_field_tag "action_input" %>
      <div>
        <span class="ml mb">
          <%= select_tag "action_selector" , options_for_select([["Set checked items to active", "active"], ["Set checked items to inactive", "inactive"], ["Delete checked items","delete"]], :selected => ""), {:tabindex => "-1", :include_blank => true, "data-placeholder" => "Actions...", :id => "multiple_listings_actions", :class => "chzn-select"} %> 
        </span>
        <%= link_to "List a New Playset", new_mtg_cards_listings_playset_path, :class => "right button mr mb" %>
        <%= link_to "List a New Card", new_generic_mtg_cards_listings_path, :class => "right button mr mb" %>
      </div>
      <table class="data fixed">
      	<tr class="header_row">
      	  <th width="5%"><%= check_box_tag "listings", 1, false, {:id => "check_all_listings"} %></th>
      		<th>Card Name</th>
      		<th width="9%">Set</th>      
      		<th width="9%">Cond.</th>
      		<th width="9%">Lang.</th>
      		<th width="10%">Options</th>
      		<th width="12%">Price</th>    		
      		<th width="9%">Qty.</th>
      		<th width="8%">Edit</th>
      	</tr>
  	
        <%= render :partial => "mtg/cards/listings/teaser" , :collection => @listings, :as => "listing" %>
    
        <% if @listings.count == 0 %>
          <tr>          
            <% if (not current_user.active) && params[:section] == "active" %>
              <td colspan=9 class="odd"><i>Note: All your listings are temporarily inactive due to your seller status</i></td>
            <% else %>
              <td colspan=9 class="odd"><i>None</i></td>            
            <% end %>
          </tr>
        <% end %>

      </table>

    <% end %>
    
  <% else %>
  
    <% if (not current_user.active) && params[:section] == "active" %>
      <p class="ma"><i>Note: All your listings are temporarily inactive due to your seller status</i></p>
    <% elsif params[:filter] != "false" %>
      <%= render :partial => "mtg/no_results", :locals => { :filter_by => "cookies", :use_seller_filter => false } %>
    <% else %>  
      <%= link_to "Create New Listing", new_generic_mtg_cards_listings_path, :class => "right button mr mb" %>  
      <p class="ma"><i>No Listings...</i></p>
    <% end %>

  
  <% end %>
  
  <br class="spacer"/>
  
  <div class="center_wrap">
    <div class="paginator center">
      <%= paginate @listings, :method => :get %>
    </div>
  </div>
    
</div>



<div id="dialog-confirm" class="hidden" title="Empty the recycle bin?">
    <p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>These items will be permanently deleted and cannot be recovered. Are you sure?</p>
</div>